<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>H·ªá Th·ªëng Smart Farm</title>
  <link rel="stylesheet" href="stile.css" />
</head>
<body>
  <header>
    <h1>Smart Farm</h1>
    <h2 id="clock">--:--:--</h2>
  </header>

  <!-- C·∫¢M BI·∫æN -->
  <div class="sensor-row">
    <div class="card">
      <img src="img/nhietdo.png" alt="Nhi·ªát ƒë·ªô" />
      <h3>Nhi·ªát ƒë·ªô</h3>
      <div id="nhietdo-value" class="sensor-value">-- ¬∞C</div>
    </div>
    <div class="card">
      <img src="img/doamkk.png" alt="ƒê·ªô ·∫©m" />
      <h3>ƒê·ªô ·∫©m</h3>
      <div id="doam-value" class="sensor-value">-- %</div>
    </div>
    <div class="card">
      <img src="img/light.png" alt="√Ånh s√°ng" />
      <h3>√Ånh s√°ng</h3>
      <div id="anhsang-value" class="sensor-value">-- lux</div>
    </div>
    <div class="card">
      <img src="img/doamdat.png" alt="ƒê·ªô ·∫©m ƒë·∫•t" />
      <h3>ƒê·ªô ·∫©m ƒë·∫•t</h3>
      <div id="doamdat-value" class="sensor-value">-- %</div>
    </div>
  </div>

  <!-- THI·∫æT B·ªä -->
  <div class="dashboard">
    <div class="card">
      <img id="pum" src="img/pump.png" alt="B∆°m" />
      <h3>B∆°m</h3>
      <div class="btn-group">
        <button id="btn1">B·∫≠t</button>
        <button id="btn2">T·∫Øt</button>
      </div>
    </div>
    <div class="card">
      <img id="mist" src="img/mist.png" alt="Phun s∆∞∆°ng" />
      <h3>Phun s∆∞∆°ng</h3>
      <div class="btn-group">
        <button id="btn5">B·∫≠t</button>
        <button id="btn6">T·∫Øt</button>
      </div>
    </div>
    <div class="card">
      <img id="valve" src="img/valve.png" alt="Van x·∫£" />
      <h3>Van x·∫£</h3>
      <div class="btn-group">
        <button id="btn7">B·∫≠t</button>
        <button id="btn8">T·∫Øt</button>
      </div>
    </div>
    <div class="card">
      <img id="light" src="img/den.png" alt="ƒê√®n" />
      <h3>ƒê√®n</h3>
      <div class="btn-group">
        <button id="btn9">B·∫≠t</button>
        <button id="btn10">T·∫Øt</button>
      </div>
    </div>
    <div class="card">
      <img id="fan" src="img/fan.png" alt="Qu·∫°t" />
      <h3>Qu·∫°t</h3>
      <div class="btn-group">
        <button id="btn3">B·∫≠t</button>
        <button id="btn4">T·∫Øt</button>
      </div>
    </div>
  </div>

<!-- N√∫t AUTO -->
  <div class="auto-section">
    <div class="card">
      <h2 style="display:inline">AUTO:</h2>
      <button id="autoBtn">OFF</button>
      <button id="attrBtn" >!</button>
      <span id="info">
        üëâKhi b·∫°n b·∫≠t ch·∫ø ƒë·ªô t·ª± ƒë·ªông, h·ªá th·ªëng s·∫Ω thu th·∫≠p th√¥ng tin t·ª´ d·ªØ li·ªáu c·∫£m bi·∫øn v√† 
        t·ª± ƒë·ªông ƒëi·ªÅu ch·ªânh c√°c thi·∫øt b·ªã cho ph√π h·ª£p v·ªõi m√¥i tr∆∞·ªùng
      </span>
    </div>
  </div>

  <footer>
    <p>¬© 2025 Smart Farm - QU√ÅCH VƒÇN K·ª≤ 23661032 / L√ä VƒÇN NGU·ªíN 23661034</p>
  </footer>

  <script>
    // ƒê·ªìng h·ªì th·ªùi gian th·ª±c
    function updateClock() {
      const now = new Date();
      document.getElementById("clock").textContent = now.toLocaleTimeString();
    }
    setInterval(updateClock, 1000);
    updateClock(); // g·ªçi l·∫ßn ƒë·∫ßu
  </script>
  <!--------------------------function c√°c n√∫t nh·∫•n ·ªü file function---------------------------------------------------------------->
  <script src="function.js"></script>

   <!-- K·∫øt n·ªëi Firebase -->
  <!-- The core Firebase JS SDK is always required and must be listed first -->
  <script src="https://www.gstatic.com/firebasejs/8.2.10/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.2.10/firebase-database.js"></script>
  <!-- TODO: Add SDKs for Firebase products that you want to use
       https://firebase.google.com/docs/web/setup#available-libraries -->
  <script src="https://www.gstatic.com/firebasejs/8.2.10/firebase-analytics.js"></script>
  
  <script>
    // Firebase c·∫•u h√¨nh
    var firebaseConfig = {
      apiKey: "AIzaSyBaZgHe9UKU5Qe6FBgsW0VPmNHX028jzmU",
      authDomain: "smartfam-9256d.firebaseapp.com",
      databaseURL: "https://smartfam-9256d-default-rtdb.firebaseio.com",
      projectId: "smartfam-9256d",
      storageBucket: "smartfam-9256d.firebasestorage.app",
      messagingSenderId: "1020077202687",
      appId: "1:1020077202687:web:d27398e5fa0f1f609b00ca",
      measurementId: "G-1LXSHL9HDZ"
    };
    // Kh·ªüi t·∫°o Firebase
    firebase.initializeApp(firebaseConfig);
    firebase.analytics();
    // L·∫•y ph·∫ßn t·ª≠ DOM
    var nhietdo = document.getElementById('nhietdo-value');
    var doam = document.getElementById('doam-value');
    var anhsang = document.getElementById('anhsang-value');
    var doamdat = document.getElementById('doamdat-value');
    // ƒê·ªçc d·ªØ li·ªáu t·ª´ Firebase
    var dbRef = firebase.database().ref().child('Nhietdo');  
    var dbRef2 = firebase.database().ref('doam');
    var dbRef3 = firebase.database().ref('anhsang');
    var dbRef4 = firebase.database().ref('doamdat');
    dbRef.on('value', snap => nhietdo.innerText = snap.val() + " ¬∞C");
    dbRef2.on('value', snap => doam.innerText = snap.val() + " %");
    dbRef3.on('value', snap => anhsang.innerText = snap.val()+ " lux");
    dbRef4.on('value', snap => doamdat.innerText = snap.val() + " %");

    //----- C·∫¨P NH·∫¨T TR·∫†NG TH√ÅI THI·∫æT B·ªä T·ª™ FIREBASE ------------------------------------
    function updateUIFromFirebase(img, btnOn, btnOff, imgOnSrc, imgOffSrc, value) {
    if (value === 1) {
      img.src = imgOnSrc;
      btnOn.classList.add('active-on');
      btnOff.classList.remove('active-on', 'active-off');
    } else {
      img.src = imgOffSrc;
      btnOff.classList.add('active-off');
      btnOn.classList.remove('active-on', 'active-off');
    }}

    // ======== B∆†M ========================
    firebase.database().ref("thietbi1/bom").once('value', snapshot => {
      const value = snapshot.val();
      updateUIFromFirebase(imgpum, btn1, btn2, 'img/pumpon1.png', 'img/pump.png', value);
    });

    // ======== PHUN S∆Ø∆†NG ==================
    firebase.database().ref("thietbi2/phun_suong").once('value', snapshot => {
      const value = snapshot.val();
      updateUIFromFirebase(imgmist, btn5, btn6, 'img/miston.png', 'img/mist.png', value);
    });

    // ======== VAN X·∫¢ ======================
    firebase.database().ref("thietbi3/van_xa").once('value', snapshot => {
      const value = snapshot.val();
      updateUIFromFirebase(imgvalve, btn7, btn8, 'img/valveon.png', 'img/valve.png', value);
    });

    // ======== ƒê√àN =========================
    firebase.database().ref("thietbi4/den").once('value', snapshot => {
      const value = snapshot.val();
      updateUIFromFirebase(imglight, btn9, btn10, 'img/denon.png', 'img/den.png', value);
    });

    // ======== QU·∫†T ========================
    firebase.database().ref("thietbi5/quat").once('value', snapshot => {
      const value = snapshot.val();
      updateUIFromFirebase(imgfan, btn3, btn4, 'img/fanon.png', 'img/fan.png', value);
    });
    // Khi trang load, ƒë·ªçc tr·∫°ng th√°i t·ª´ Firebase
    firebase.database().ref("autoBtn").on("value", (snapshot) => {
      const value = snapshot.val();
      if (value === 1) {
        btn.classList.add("on");
        btn.classList.remove("off");
        btn.textContent = "ON";
      } else {
        btn.classList.remove("on");
        btn.classList.add("off");
        btn.textContent = "OFF";
      }
    });
  </script>
 
</body>
</html>
